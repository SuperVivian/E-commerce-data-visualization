<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>电商大屏</title>
    <link rel="stylesheet" href="{{url_for('static',filename='css/user.css')}}" />
</head>

<body>
    <div class="header">
        <h3 class="header-title">用 户 画 像</h3>
        <div class="header-info header-info-l"><a  class="page_a" href="{{url_for('main.index')}}">返回首页</a></div>
        <div class="header-info header-info-r">数据日期：2019年6月10日-6月20日<span id="nowDate"></span></div>
    </div>
    <footer id="footer"></footer>
    <div class="wrapper">
        <div class="content">
            <div class="col col-l">
                <div class="xpanel-wrapper xpanel-wrapper-40">
                    <div class="xpanel xpanel-c-b">
                        <div class="title title-long">基础信息</div>
                        <div class="xpanel-wrapper xpanel-wrapper-70">
                            <div class="chart-div" id="ageChart">
                                <div class="chart-loader">
                                    <div class="loader"></div>
                                </div>
                            </div>
                        </div>
                        <div class="xpanel-wrapper xpanel-wrapper-30" id="gender">
                            <table class="data-t">
                                <tr>
                                    <th><img src="../static/img/user/male.png" /></th>
                                    <td>
                                        <p><span id="male">0</span></p>
                                    </td>
                                    <th><img src="../static/img/user/female.png" /></th>
                                    <td>
                                        <p><span id="female">0</span></p>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="xpanel-wrapper xpanel-wrapper-60">
                    <div class="xpanel xpanel-c-b">
                        <div class="title title-long">社会信息</div>
                        <div class="xpanel-wrapper xpanel-wrapper-40">
                            <div class="chart-div" id="careerChart">
                                <div class="chart-loader">
                                    <div class="loader"></div>
                                </div>
                            </div>
                        </div>
                        <div class="xpanel-wrapper xpanel-wrapper-60">
                            <div class="content">
                                <div class="col col-l">
                                    <div class="xpanel-wrapper">
                                        <div class="chart-div" id="eduChart">
                                            <div class="chart-loader">
                                                <div class="loader"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col col-r">
                                    <div class="xpanel-wrapper">
                                        <div class="chart-div" id="incChart">
                                            <div class="chart-loader">
                                                <div class="loader"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col col-c">
                <div class="xpanel-wrapper xpanel-wrapper-30">
                    <div class="xpanel no-bg">
                        <table class="data-t">
                            <tr>
                                <th><img src="../static/img/user/users1.png" /></th>
                                <td>
                                    <p><span id="totalUser">0</span></p>
                                    <p>总用户数</p>
                                </td>
                                <th><img src="../static/img/user/users2.png" /></th>
                                <td>
                                    <p><span id="activeUser">0</span></p>
                                    <p>活跃用户数</p>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="xpanel-wrapper xpanel-wrapper-70">
                    <div class="xpanel xpanel-c-b">
                        <div class="title title-long">地域分布</div>
                        <div class="chart-div" id="mapChart">
                            <div class="chart-loader">
                                <div class="loader"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col col-r">
                <div class="xpanel xpanel-c-b">
                    <div class="title title-long">用户画像</div>
                    <div class="personas-group">
                        <div class="xpanel-wrapper xpanel-wrapper-30">
                            <div class="persona-info">
                                <img src="../static/img/user/user1.png" />
                                <p>品质生活型</p>
                            </div>
                            <div class="chart-div" id="usrChart1">
                                <div class="chart-loader">
                                    <div class="loader"></div>
                                </div>
                            </div>
                        </div>
                        <div class="xpanel-wrapper xpanel-wrapper-30">
                            <div class="persona-info">
                                <img src="../static/img/user/user2.png" />
                                <p>品牌导向型</p>
                            </div>
                            <div class="chart-div" id="usrChart2">
                                <div class="chart-loader">
                                    <div class="loader"></div>
                                </div>
                            </div>
                        </div>
                        <div class="xpanel-wrapper xpanel-wrapper-30">
                            <div class="persona-info">
                                <img src="../static/img/user/user3.png" />
                                <p>犹豫不决型</p>
                            </div>
                            <div class="chart-div" id="usrChart3">
                                <div class="chart-loader">
                                    <div class="loader"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="personas-group hide">
                        <div class="xpanel-wrapper xpanel-wrapper-30">
                            <div class="persona-info">
                                <img src="../static/img/user/user4.png" />
                                <p>奢侈享受型</p>
                            </div>
                            <div class="chart-div" id="usrChart4">
                                <div class="chart-loader">
                                    <div class="loader"></div>
                                </div>
                            </div>
                        </div>
                        <div class="xpanel-wrapper xpanel-wrapper-30">
                            <div class="persona-info">
                                <img src="../static/img/user/user5.png" />
                                <p>理性消费型</p>
                            </div>
                            <div class="chart-div" id="usrChart5">
                                <div class="chart-loader">
                                    <div class="loader"></div>
                                </div>
                            </div>
                        </div>
                        <div class="xpanel-wrapper xpanel-wrapper-30">
                            <div class="persona-info">
                                <img src="../static/img/user/user6.png" />
                                <p>知足常乐型</p>
                            </div>
                            <div class="chart-div" id="usrChart6">
                                <div class="chart-loader">
                                    <div class="loader"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/jquery-3.3.1.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/echarts.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/user/echarts-map-china.js') }}"></script>
    <script src="{{ url_for('static', filename='js/user/echarts-theme-shine.js') }}"></script>
    <script src="{{ url_for('static', filename='js/user/countUp.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/user/usrinfo.js') }}"></script>
    <script src="{{ url_for('static', filename='js/user/personas.js') }}"></script>
    <script type="text/javascript">
    var user_day = null;
    var i = 0; //计数器
    $(function() {
        //获取统计数据
        $.ajax({
            url: "../static/data/user-count-data.json",
            dataType: "json"
        }).done(function(data) {
            //console.log('Data: ', data);
            user_day = data.user_day;
            rollNum("totalUser", 0, user_day[0].total_user);
            rollNum("activeUser", 0, user_day[0].active_user);
            $("#male").text(data.user_sex.male + "%");
            $("#female").text(data.user_sex.female + "%");
            change();
        }).fail(function(jqXHR, textStatus) {
            console.log("Ajax Error: ", textStatus);
        });

        //获取地域分布数据
        const mapChart = echarts.init(document.getElementById("mapChart"), "shine");
        const mapChartOpt = {
            tooltip: {
                formatter: function(params) {
                    const data = params.data;
                    if (data != null) {
                        return data.name + "<br />用户数：" + (data.value * 100).toFixed(2) + "%";
                    }
                }
            },
            visualMap: {
                type: "piecewise",
                splitNumber: 5,
                itemWidth: 10,
                itemHeight: 10,
                itemGap: 5,
                textGap: 5,
                textStyle: {
                    fontSize: 10,
                    color: "#b0c2f9"
                },
                min: 0,
                max: 0.1,
                calculable: true,
                seriesIndex: [0]
            },
            geo: {
                map: "china",
                roam: true, //开启鼠标缩放和漫游
                zoom: 1, //地图缩放级别
                selectedMode: "single",
                top: 10,
                bottom: 10,
                layoutCenter: ["50%", "50%"],
                //layoutSize: "100%", //保持地图宽高比
                label: {
                    show: true,
                    fontSize: 10,
                    color: "#ceac09"
                }
            },
            series: [{
                name: "地域分布",
                type: "map",
                geoIndex: 0
            }]
        };
        mapChart.setOption(mapChartOpt);
        $.ajax({
            url: "../static/data/user-region-count.json",
            dataType: "json"
        }).done(function() {
            $("#mapChart").addClass("chart-done");
        }).done(function(data) {
            //console.log('Data: ', data);
            const chartData = [];
            for (let i in data) {
                chartData.push({
                    name: data[i].name,
                    value: data[i].value
                });
            }
            mapChart.setOption({
                series: [{
                    name: "地域分布",
                    data: chartData
                }]
            });
        }).fail(function(jqXHR) {
            console.log("Ajax Fail: ", jqXHR.status, jqXHR.statusText);
        });

    });


    //数字变化特效
    function rollNum(elId, startVal, endVal, decimalNum) {
        let n = decimalNum || 0;
        let countUp = new CountUp(elId, startVal, endVal, n, 2.5, {
            useEasing: true,
            useGrouping: true,
            separator: ',',
            decimal: '.'
        });
        if (!countUp.error) {
            countUp.start();
        } else {
            console.error(countUp.error);
        }
    }

    function change() {
        if (i >= user_day.length) { i = 0; }
        $("#totalUser").text(user_day[i].total_user);
        $("#activeUser").text(user_day[i++].active_user);
        setTimeout("change()", 3000);
    }
    //3个div的统一class = 'div'
    var index = 0;
    //3秒轮播一次
    var timer = setInterval(function() {
        index = (index == 1) ? 0 : 1;
        //某个div显示，其他的隐藏
        $(".personas-group").hide().eq(index).fadeTo(1000,1);
    }, 8000);
    </script>
</body>

</html>